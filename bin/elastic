#!/usr/bin/env bash

set -e

VERSION="0.1"

if [[ -z "$ELASTIC_DIR" ]]; then
  self="${BASH_SOURCE[0]}"
  ELASTIC_DIR="$( cd "$( dirname "$self" )"/../ >/dev/null 2>&1 && pwd )"
fi

source "$ELASTIC_DIR/src/util"

CURL="curl --silent --show-error"
CLUSTER="http://localhost:9200"
VERBOSE=0
DRY_RUN=0
POSITIONAL=()

while [[ $# -gt 0 ]]; do
  arg="$1"

  case $arg in
    -c|--cluster)
      CLUSTER="$2"; assert "$CLUSTER" "missing value for --cluster option"; shift; shift
      ;;
    -v|--verbose)
      VERBOSE=1; shift
      ;;
    -d|--dry-run)
      DRY_RUN=1; shift
      VERBOSE=1
      ;;
    --version)
      echo "v${VERSION}"
      exit 0
      ;;
    -h|--help)
      CMD="help"; shift
      ;;
    *)
      if [[ -z $CMD ]]; then
        CMD="$1";
      else
        POSITIONAL+=("$1")
      fi

      shift
    ;;
  esac
done

CMD=${CMD:-help}
set -- "${POSITIONAL[@]}"

run_cmd $CMD "$@"
